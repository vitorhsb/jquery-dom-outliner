/*! dom-outliner - v0.1.0 - 2014-10-10
* https://github.com/vitorhsb/dom-outliner
* Copyright (c) 2014 Vitor Barbosa; Licensed MIT */
!function(a){function b(){f(),h(),e()}function c(){g(),i()}function d(a){var b=document.createElement("style");b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet?b.styleSheet.cssText=a:b.innerHTML=a}function e(){var a="."+w+" {outline: "+v.outlineWidth+"px "+v.outlineStyle+" "+v.outlineColor+";}."+y+" {background: "+v.outlineColor+";color: #fff;font: bold 12px/12px Helvetica, Arial, sans-serif;padding: 5px;margin: 0;position: absolute;z-index: 1000001;}."+x+" {outline: "+v.outlineWidth+"px "+v.outlineStyle+" "+v.outlineSelectedColor+";}."+z+" {background: "+v.outlineSelectedColor+";z-index: 2000002;}."+A+' {opacity: 0.8 !important;-moz-opacity: 0.8 !important;filter: alpha(opacity=0.8) !important;-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=($value*100))" !important;background: #F4F5F6;position: absolute;top: 0;left: 0;z-index: 2000001;min-height: 0 !important;min-width: 0 !important;}.'+B+' {background: rgba(0, 0, 0, 0);opacity: 1.0 !important;-moz-opacity: 1 !important;filter: alpha(opacity=1) !important;-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=($value*100))" !important;}';d(a)}function f(){D={label:a("<div></div>").addClass(w+"-label").appendTo(F.getBody())}}function g(){a.each(D,function(a,b){b.remove()}),D={}}function h(){C={center:a('<div id="'+A+'-center" class="'+A+" "+B+'"/></div>').appendTo(F.getBody()),top:a('<div id="'+A+'-top" class="'+A+'"/></div>').appendTo(F.getBody()),right:a('<div id="'+A+'-right" class="'+A+'"/></div>').appendTo(F.getBody()),bottom:a('<div id="'+A+'-bottom" class="'+A+'"/></div>').appendTo(F.getBody()),left:a('<div id="'+A+'-left" class="'+A+'"/></div>').appendTo(F.getBody())},a.each(C,function(b,c){c.on("click."+w,function(){m(a(E))})})}function i(){a.each(C,function(a,b){b.off("click."+w).remove()}),C={}}function j(b){var c=F.getDocument(),d=c.height(),e=c.width();if(b.each(function(){a(this).addClass(x)}),v.showGlasses)try{var f=b.offset(),g=b.outerHeight(),h=b.outerWidth();C.center.css({top:f.top-v.outlineWidth,left:f.left-v.outlineWidth,height:g+2*v.outlineWidth,width:h+2*v.outlineWidth}).show(),C.top.css({top:0,left:0,height:f.top-v.outlineWidth,width:e}).show(),C.right.css({top:f.top-v.outlineWidth,left:f.left+h+v.outlineWidth,height:g+2*v.outlineWidth,width:e-f.left-h-v.outlineWidth}).show(),C.bottom.css({top:f.top+g+v.outlineWidth,left:0,height:d-f.top-g-v.outlineWidth,width:e}).show(),C.left.css({top:f.top-v.outlineWidth,left:0,height:g+2*v.outlineWidth,width:f.left-v.outlineWidth}).show()}catch(i){}finally{}v.showLabel&&D.label.addClass(z)}function k(a){a.removeClass(x).removeClass(w).off("."+w),D.label.removeClass(z).hide()}function l(b){E=b,j(b),a.isFunction(v.onSelection)&&v.onSelection(b.get(0))}function m(){E&&(a.each(C,function(a,b){b.hide()}),k(a(E)),u&&a.isFunction(v.onCancel)&&v.onCancel(E),E=null)}function n(b){var c=!1;return v.filter&&(c=!0,a.each(v.filter,function(a,d){c=c&&!b.is(d)})),!c&&v.exclude&&a.each(v.exclude,function(a,d){return c=c||b.is(d),c?!1:!0}),!c&&E&&b.filter(":outliner").length&&(c=!0),!c&&v.excludeClosest&&b.closest(v.excludeClosest).length&&(c=!0),c}function o(b){var c=b.get(0),d=c.tagName.toLowerCase(),e=c.className;return e=e.replace(x,""),e=e.replace(w,""),d+=c.id?"#"+c.id:"",e&&(d+=("."+a.trim(e).replace(/ /g,".")).replace(/\.\.+/g,".")),d+" ("+Math.round(b.width())+"x"+Math.round(b.height())+")"}function p(a){var b="",c=a.offset();a.toggleClass(w),v.showLabel&&(b=o(a),D.label.html(b).show().css({top:Math.max(0,c.top-v.outlineWidth-D.label.outerHeight()),left:Math.max(0,c.left-v.outlineWidth)}),a.hasClass(w)||D.label.hide())}function q(a){return E?m():l(a)}function r(){var c;v.base=v.base||a("body"),c=a(v.base),t||b(),t=!0,u=!0,c.length&&c.off("."+w).on("mouseover."+w+" mouseout."+w+" click."+w,function(b){var c=a(b.target);n(c)||("click"===b.type?q(c):p(c))})}function s(){var b=v.$base||a();u=!1,m(),c(),b.length&&b.off("."+w)}var t=!1,u=!1,v={},w="dom-outliner",x=w+"-selected",y=w+"-label",z=y+"-selected",A=w+"-glass",B=w+"-transparent-glass",C={},D={},E=null,F=function(){var b=a(),c=a(),d=a();return{getWindow:function(){return b.length?b:b=a(window)},getDocument:function(){return c.length?c:c=a(document)},getBody:function(){return d.length?d:d=a("body")}}}();a.fn.outliner=function(b){return v=a.extend({},a.outliner.options,v,b),r(),m(),this.each(function(){var b=a(this).addClass(w);l(b)})},a.outliner=function(b){if(!b||"string"!=typeof b)return v=a.extend({},a.outliner.options,v,b),r(),this;switch(b){case"stop":s()}},v=a.outliner.options={base:null,outlineWidth:2,outlineStyle:"solid",outlineColor:"#c00",outlineSelectedColor:"blue",showGlasses:!0,showLabel:!0,stopOnSelection:!1,onSelection:null,onCancel:null,filter:null,exclude:["."+w+"-glass","."+w+"-label"],excludeClosest:null},a.expr[":"].outliner=function(b){return a(b).hasClass(w)||a(b).hasClass(x)}}(jQuery);